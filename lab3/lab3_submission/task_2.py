# +

import angr
import claripy
from angrutils import *
# -
START = 0x402e43
TARGET = '0x402e29'
ROUTE = ['0x402e29', '0x401090', '0x402e1a', '0x402df6', '0x402e09', '0x402b81', '0x402aed', '0x402adb', '0x4015e8', '0x4015d5', '0x4015c2', '0x4015af', '0x40159c', '0x4016ad', '0x401c59', '0x401c46', '0x401c33', '0x401635', '0x40219d', '0x401c20', '0x401dc3', '0x402686', '0x402673', '0x402660', '0x401a92', '0x4019d3', '0x40264d', '0x40263a', '0x401e69', '0x40262d', '0x40261a', '0x402607', '0x402c51', '0x4025e1', '0x401b69', '0x401b56', '0x401b43', '0x401b30', '0x4025c7', '0x40255d', '0x402d0e', '0x401b1d', '0x401b0a', '0x401af7', '0x401ae4', '0x402537', '0x402524', '0x402511', '0x40229e', '0x402961', '0x402842', '0x40294e', '0x4020dc', '0x402989', '0x4020c9', '0x4020b6', '0x4020a3', '0x402090', '0x401551', '0x40153e', '0x4025b4', '0x40152b', '0x401a0c', '0x4019f9', '0x401bb6', '0x401699', '0x4019e6', '0x4019c0', '0x4019ad', '0x402b6c', '0x402b5d', '0x401fd0', '0x401fbd', '0x401db0', '0x401d9d', '0x402d34', '0x4029f8', '0x401d8a', '0x401d77', '0x401d64', '0x401d51', '0x401d3e', '0x4028ed', '0x4028da', '0x4028c7', '0x4028b4', '0x401447', '0x401434', '0x401421', '0x40140e', '0x40258e', '0x40257f', '0x4029d2', '0x4029bf', '0x4029ac', '0x402337', '0x402324', '0x402311', '0x4022fe', '0x4024a3', '0x402494', '0x4022b2', '0x401660', '0x40164d', '0x402d64', '0x402c2a', '0x402116', '0x402103', '0x4020f0', '0x40163a', '0x4017d4', '0x4012a3', '0x401290', '0x401abd', '0x401aaa', '0x401a97', '0x401686', '0x401673', '0x401283', '0x4013c2', '0x4013af', '0x401362', '0x401206', '0x401249', '0x40125c', '0x4012c9', '0x401edd', '0x402de1', '0x402dd2', '0x4027f3', '0x4027e0', '0x4027cd', '0x401f3c', '0x401f29', '0x401f16', '0x401833', '0x401f03', '0x402408', '0x4023f5', '0x402c15', '0x401c0f', '0x402c02', '0x402208', '0x402bf3', '0x402be6', '0x402868', '0x401564', '0x402855', '0x402c3d', '0x402721', '0x402480', '0x40246d', '0x40245a', '0x401960', '0x40194d', '0x402bcd', '0x40292a', '0x4025ce', '0x402917', '0x402d21', '0x402904', '0x4021eb', '0x4015fb', '0x401820', '0x40180d', '0x4017fa', '0x4026ad', '0x4026d5', '0x4026c6', '0x401f89', '0x401f76', '0x4013fb', '0x4013e8', '0x4013d5', '0x4028a1', '0x4023c9', '0x402a8f', '0x4021c4', '0x402a7c', '0x402a69', '0x402a56', '0x4022c5', '0x401fb0', '0x401cde', '0x401ccb', '0x401cb8', '0x4014a6', '0x401ca5', '0x401c92', '0x401c7f', '0x401c6c', '0x401493', '0x401480', '0x401397', '0x402bba', '0x4016d3', '0x402ba7', '0x402b94', '0x4026ea', '0x4016e6', '0x4016c0', '0x401384', '0x401371', '0x4012ef', '0x4012dc', '0x401893', '0x401880', '0x40186d', '0x40201d', '0x40200a', '0x401775', '0x401762', '0x401846', '0x402444', '0x402431', '0x40241e', '0x401e7d', '0x402255', '0x40193a', '0x40288e', '0x40127e', '0x40287b', '0x40126b', '0x401a46', '0x401a33', '0x401a20', '0x401236',  '0x401218', '0x4014df', '0x4014cc', '0x4014b9', '0x401ad1', '0x401753', '0x401622', '0x402797', '0x402784', '0x402b0f', '0x402b00', '0x401315', '0x401302', '0x401dd7', '0x402345', '0x401fe3', '0x4012b6', '0x401926', '0x401913', '0x401900', '0x402d4c', '0x40133b', '0x402d3d', '0x4023dc', '0x401328', '0x402241', '0x40222e', '0x40221b', '0x402129', '0x4021fe', '0x401ec9', '0x401eb6', '0x401ea3', '0x401e90', '0x40207c', '0x402069', '0x402056', '0x402043', '0x4021d7', '0x401dea', '0x402030', '0x402cad', '0x40145a', '0x402c9a', '0x402c8b', '0x401986', '0x401973', '0x4023b6', '0x401a6c', '0x4024fe', '0x401d2a', '0x401d17', '0x401d04', '0x401cf1', '0x401ff6', '0x4024eb', '0x40160e', '0x4024de', '0x401518', '0x4024cb', '0x401505', '0x4014f2', '0x4018b6', '0x40276f', '0x40275c', '0x402749', '0x402736', '0x401745', '0x401732', '0x4026c0', '0x40171f', '0x4026fd', '0x40170c', '0x4016f9', '0x401e56', '0x401571', '0x401e49', '0x401e36', '0x401e23', '0x401e10', '0x401dfd', '0x4022eb', '0x4022d8', '0x402a41', '0x402a2e', '0x402c75', '0x402c66', '0x401bfc', '0x401be9', '0x401a7f', '0x401bd6', '0x401bc9', '0x401a59', '0x4018a3', '0x4024b6', '0x4018ed', '0x4018da', '0x401ef0', '0x4018c9', '0x40199a', '0x401589', '0x402358', '0x4011f8', '0x4011e9', '0x4011da', '0x401788', '0x402a0b', '0x402ac6', '0x402ab8', '0x4029e5', '0x4021b0', '0x401859', '0x40280a', '0x402814', '0x40281d', '0x40218a', '0x4017ae', '0x401ba2', '0x401b8f', '0x401b7c', '0x40179b', '0x401f9c', '0x402150', '0x4011c9', '0x402e71', '0x402e5c', '0x500010', '0x4010a0', '0x402e57', '0x402e43', '0x500018', '0x4010b0', '0x601060', '0x500000', '0x402ef6', '0x402ed1', '0x402eed', '0x402ed7', '0x401178', '0x402ee0', '0x4011b8', '0x4011ac', '0x4011a7', '0x401138', '0x401110', '0x401123', '0x40118d', '0x40119b', '0x401180', '0x401140', '0x401164', '0x4011c0', '0x402ea0', '0x401016', '0x401000', '0x401014', '0x4010e0', '0x402cfb', '0x402ce8', '0x402cd9', '0x402976', '0x402cca', '0x402163', '0x402d9d', '0x402d8e', '0x40134e', '0x401f62', '0x401f4f', '0x402570', '0x4023e2', '0x40254a', '0x40282f', '0x4023a1', '0x40238e', '0x40237b', '0x40236c', '0x402712', '0x402176', '0x402dc3', '0x402db4', '0x402265', '0x40299d', '0x4013aa', '0x4025a1', '0x402aa2', '0x40293f', '0x402b48', '0x402b35', '0x402b22', '0x402699', '0x40228b', '0x402278', '0x4025f4', '0x4027b7', '0x4027ae']
#ROUTE_TMP = ['0x402e29', '0x401090', '0x402e1a', '0x402df6', '0x402e09', '0x402b81', '0x402aed', '0x402adb', '0x4015e8', '0x4015d5', '0x4015c2', '0x4015af', '0x40159c', '0x4016ad', '0x401c59', '0x401c46', '0x401c33', '0x401635', '0x40219d', '0x401c20', '0x401dc3', '0x402d7a', '0x402686', '0x402673', '0x402660', '0x401a92', '0x4019d3', '0x40264d', '0x40263a', '0x401e69', '0x40262d', '0x40261a', '0x402607', '0x402c51', '0x4025e1', '0x401b69', '0x401b56', '0x401b43', '0x401b30', '0x4025c7', '0x40255d', '0x402d0e', '0x401b1d', '0x401b0a', '0x401af7', '0x401ae4', '0x402537', '0x402524', '0x402511', '0x40229e', '0x402961', '0x402842', '0x40294e', '0x4020dc', '0x402989', '0x4020c9', '0x4020b6', '0x4020a3', '0x402090', '0x401551', '0x40153e', '0x4025b4', '0x40152b', '0x401a0c', '0x4019f9', '0x401bb6', '0x401699', '0x4019e6', '0x4019c0', '0x4019ad', '0x402b6c', '0x402b5d', '0x401fd0', '0x401fbd', '0x401db0', '0x401d9d', '0x402d34', '0x4029f8', '0x401d8a', '0x401d77', '0x401d64', '0x401d51', '0x401d3e', '0x4028ed', '0x4028da', '0x4028c7', '0x4028b4', '0x401447', '0x401434', '0x401421', '0x40140e', '0x40258e', '0x40257f', '0x4029d2', '0x4029bf', '0x4029ac', '0x402337', '0x402324', '0x402311', '0x4022fe', '0x4024a3', '0x402494', '0x4022b2', '0x401660', '0x40164d', '0x402d64', '0x402c2a', '0x402116', '0x402103', '0x4020f0', '0x40163a', '0x4017e7', '0x4017d4', '0x4012a3', '0x401290', '0x401abd', '0x401aaa', '0x401a97', '0x401686', '0x401673', '0x401283', '0x4017c1', '0x4013c2', '0x4013af', '0x401362', '0x401206', '0x401249', '0x401210', '0x40125c', '0x4012c9', '0x401edd', '0x402de1', '0x402dd2', '0x4027f3', '0x4027e0', '0x4027cd', '0x401f3c', '0x401f29', '0x401f16', '0x401833', '0x401f03', '0x402408', '0x4023f5', '0x402c15', '0x401c0f', '0x402c02', '0x402208', '0x402bf3', '0x402be6', '0x402868', '0x401564', '0x402855', '0x402c3d', '0x402721', '0x402480', '0x40246d', '0x40245a', '0x401960', '0x40194d', '0x402bcd', '0x40292a', '0x4025ce', '0x402917', '0x402d21', '0x402904', '0x4021eb', '0x4015fb', '0x401820', '0x40180d', '0x4017fa', '0x4026ad', '0x4026d5', '0x4026c6', '0x401f89', '0x401f76', '0x4013fb', '0x4013e8', '0x4013d5', '0x4028a1', '0x4023c9', '0x402a8f', '0x4021c4', '0x402a7c', '0x402a69', '0x402a56', '0x4022c5', '0x401fb0', '0x401cde', '0x401ccb', '0x401cb8', '0x4014a6', '0x401ca5', '0x401c92', '0x401c7f', '0x401c6c', '0x401493', '0x401480', '0x401397', '0x402bba', '0x4016d3', '0x402ba7', '0x402b94', '0x4026ea', '0x4016e6', '0x4016c0', '0x401384', '0x401371', '0x4012ef', '0x4012dc', '0x401893', '0x401880', '0x40186d', '0x40201d', '0x40200a', '0x401775', '0x401762', '0x401846', '0x402444', '0x402431', '0x40241e', '0x401e7d', '0x402255', '0x40193a', '0x40288e', '0x40127e', '0x40287b', '0x40126b', '0x401a46', '0x401a33', '0x401a20', '0x401236', '0x401227', '0x401218', '0x401576', '0x4014df', '0x4014cc', '0x4014b9', '0x401ad1', '0x401753', '0x401622', '0x402797', '0x402784', '0x40213d', '0x402b0f', '0x402b00', '0x401315', '0x401302', '0x401dd7', '0x402345', '0x401fe3', '0x4012b6', '0x401926', '0x401913', '0x401900', '0x402d4c', '0x40133b', '0x402d3d', '0x4023dc', '0x401328', '0x402241', '0x40222e', '0x40221b', '0x402129', '0x4021fe', '0x401ec9', '0x401eb6', '0x401ea3', '0x401e90', '0x40207c', '0x402069', '0x402056', '0x402043', '0x4021d7', '0x401dea', '0x402030', '0x402cad', '0x40145a', '0x402c9a', '0x402c8b', '0x401986', '0x401973', '0x4023b6', '0x401a6c', '0x4024fe', '0x401d2a', '0x401d17', '0x401d04', '0x401cf1', '0x401ff6', '0x4024eb', '0x40160e', '0x4024de', '0x401518', '0x4024cb', '0x401505', '0x4014f2', '0x4018b6', '0x40276f', '0x40275c', '0x402749', '0x402736', '0x401745', '0x401732', '0x4026c0', '0x40171f', '0x4026fd', '0x40170c', '0x4016f9', '0x401e56', '0x401571', '0x401e49', '0x401e36', '0x401e23', '0x401e10', '0x401dfd', '0x4022eb', '0x4022d8', '0x402a41', '0x402a2e', '0x402c75', '0x402c66', '0x401bfc', '0x401be9', '0x401a7f', '0x401bd6', '0x401bc9', '0x401a59', '0x4018a3', '0x4024b6', '0x4018ed', '0x4018da', '0x401ef0', '0x4018c9', '0x40199a', '0x401589', '0x402358', '0x4011f8', '0x4011e9', '0x4011f3', '0x4011da', '0x4011e4', '0x401788', '0x402a0b', '0x402ac6', '0x402ab8', '0x4029e5', '0x4021b0', '0x401859', '0x40280a', '0x402814', '0x40281d', '0x40218a', '0x4017ae', '0x401ba2', '0x401b8f', '0x401b7c', '0x40179b', '0x401f9c', '0x402150', '0x4011c9', '0x402e71', '0x402e5c', '0x500010', '0x4010a0', '0x402e57', '0x402e43', '0x500018', '0x4010b0', '0x601060', '0x500000', '0x402ef6', '0x402ed1', '0x402eed', '0x402ed7', '0x401178', '0x402ee0', '0x4011b8', '0x4011ac', '0x4011a7', '0x401138', '0x401110', '0x401123', '0x40118d', '0x40119b', '0x401180', '0x401140', '0x401164', '0x4011c0', '0x402ea0', '0x401016', '0x401000', '0x401014', '0x4010e0', '0x402cfb', '0x402ce8', '0x402cd9', '0x402976', '0x402cca', '0x402163', '0x402d9d', '0x402d8e', '0x40134e', '0x401f62', '0x401f4f', '0x402570', '0x4023e2', '0x40254a', '0x40282f', '0x4023a1', '0x40238e', '0x40237b', '0x40236c', '0x402712', '0x402176', '0x402dc3', '0x402db4', '0x402265', '0x40299d', '0x4013aa', '0x4025a1', '0x402aa2', '0x40293f', '0x402b48', '0x402b35', '0x402b22', '0x402699', '0x40228b', '0x402278', '0x4025f4', '0x4027b7', '0x4027ae']


path_to_binary = './explore'

project = angr.Project(path_to_binary, load_options={'auto_load_libs': False})

state = project.factory.blank_state(addr=START)


path = []
while True:
    succ = state.step()
    for i, suc in enumerate(succ.successors):
        if((hex(suc.addr) in ROUTE)):
            ROUTE.remove(hex(suc.addr))
            state = succ.successors[i]
            path.append(state)
            break
    
    if(hex(state.addr) == TARGET):
        break

ans = b''

for i, state in enumerate(path):
    simgr = project.factory.simgr(state)

    TARGET_ADDR = int(hex(state.addr), 16)
    #print(hex(state.addr))
    simgr.explore(find=TARGET_ADDR)
    s = simgr.found[0]
    #ans += s.posix.dumps(0)
    #print(s.posix.dumps(0))
    if(i == len(path)-1):
        ans = s.posix.dumps(0)

    
# write to binary
with open("./task_2.bin", "wb") as f:
    f.write(ans)
    





"""
cfg = project.analyses.CFGEmulated(keep_state=True, 
                              state_add_options=angr.sim_options.refs, 
                              context_sensitivity_level=2)

cdg = project.analyses.CDG(cfg)

ddg = project.analyses.DDG(cfg)

target_func = cfg.kb.functions.function(name="puts")

target_node = cfg.model.get_any_node(target_func.addr)

bs = project.analyses.BackwardSlice(cfg, cdg=cdg, ddg=ddg,control_flow_slice=True, targets=[ (target_node, -1) ])


print([hex(node.addr) for node in bs.cfg_nodes_in_slice])
"""






